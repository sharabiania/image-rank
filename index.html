<html>
	<head>
		<style>
			img {cursor: pointer;}
			img:hover {border: 2px solid black;}
		</style>
	</head>
	<body>
		<h1 id='title'></h1>
		<img id="img-left" width="200" height="100" onclick="leftClick()"/>
		<img id="img-right" width="200" height="100" onclick="rightClick()"/>
		<button id="btn-reset" hidden="hidden" onclick="reset()">Restart</button>
		<table id='table'></table>
		
		<script>
			const TOTAL = 5;
			var imgSet = [];
			var currSet = [];
			var winners = [];
			var currWinner = null;
			var imgLeft = document.getElementById("img-left");
			var imgRight = document.getElementById("img-right");
			var li = 0, ri = 1;
			var endFlag = false;
			var title = document.getElementById('title');

			var img = function(name) {
				this.name = name;
				this.selected = false;
			}
			img.prototype.src = function() {
				return "images/img_" + this.name + ".jpg";
			}
			img.prototype.tag = function(){
				alphabet = "ABCDEFGHIJK";
				return alphabet.charAt(this.name - 1);
			}

			function shuffle(a) {
				var j, x, i;
				for (i = a.length - 1; i > 0; i--) {
					j = Math.floor(Math.random() * (i + 1));
					x = a[i];
					a[i] = a[j];
					a[j] = x;
				}
				return a;
			}


			// initialize data set
			for(var i = 0; i < TOTAL; ++i) {
				imgSet.push(new img(i + 1));
				currSet.push(new img(i +1));
			}
			reset();
			
			// END initialize.

			function reset() {
											
				if(currSet.length == 2) {
					if(currWinner != null) {
						winners.push(currWinner);
						var index = currSet.indexOf(currWinner);
						currSet.splice(index, 1);
						console.log(currWinner.tag() + ' is out!');
						currWinner = null;
						winners.push(currSet[0]);
					}
					var table = document.getElementById('table');
					for(var i = 0; i < winners.length; i++) {
						var tr = document.createElement('tr');
						var td = document.createElement('td');					
						td.innerText = winners[i].tag();
						tr.appendChild(td);
						table.appendChild(tr);
					}

					return;
				}

				if(currSet.length > 2) {
					if(currWinner != null) {
						winners.push(currWinner);
						var index = currSet.indexOf(currWinner);
						currSet.splice(index, 1);
						console.log(currWinner.tag() + ' is out!');
						currWinner = null;
					}
					currSet = shuffle(currSet);
					title.innerText = "Round " + (TOTAL - currSet.length + 1);
					currSet = shuffle(currSet);
					imgLeft.src = currSet[0].src();
					imgRight.src = currSet[1].src();
					imgLeft.style.cursor = "pointer";
					imgRight.style.cursor = "pointer";
					document.getElementById('btn-reset').hidden = "hidden";
					endFlag = false;
					li = 0;
					ri = 1;
					return;
				}			
				
			}

			function end() {
				if(endFlag) return;				
				imgLeft.style.cursor = "default";
				imgRight.style.cursor = "default";
				document.getElementById('btn-reset').hidden = "";
				title.innerText = title.innerText + ": Winner is " + currWinner.tag();
				endFlag = true;
			}
	
			function leftClick() {		
				currWinner = currSet[li];							

				// choose a new ri
				if(ri < li) ri = li + 1;
				else ri++;													
				if(ri > currSet.length - 1) {
					ri = currSet.length - 1;
					end();
				}
				else {			
					imgRight.src = currSet[ri].src();					
				}
				
			}
			function rightClick(){
			
				currWinner = currSet[ri];

				// choose a new li
				if(li < ri) li = ri + 1;
				else li++;

				if(li > currSet.length - 1) {
					li = currSet.length - 1;
					end();
				}
				else{
					imgLeft.src = currSet[li].src();					
				}
				
				
			}
			
		</script>
	</body>
</html>